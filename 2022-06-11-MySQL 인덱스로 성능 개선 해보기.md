---
aliases: []
categories: []
date-created: June 11, 2022 2:23 PM
tags: [Database]
ì§„í–‰ìƒíƒœ: 5. Completed
date-updated: 2023-02-27 05:59
---
<br><br>
# ì¼ë‹¨ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ì„œ ì¸ë±ìŠ¤ë¥¼ ì ìš©í•´ë³´ì
<br><br>
## í…Œì´ë¸” íŒŒì•…í•˜ê¸°

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/e870ba2307fc56d0b4642e0ae046bda6.png)

![Screen Shot 2022-06-11 at 4.01.01 PM.png](Screen_Shot_2022-06-11_at_4.01.01_PM.png)

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/dfc5a05967f72f04db261b6365d1bf0d.png)

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/474c56be16fbc2c789d53f1cc0d82858.png)
<br><br>
## ì¿¼ë¦¬ ë§Œë“¤ê¸°

```sql
select emp.*, sal.salary from employees emp
join (select * from salaries
							where from_date > "1998-01-01" 
								and to_date < "1999-01-02") sal
	on emp.emp_no = sal.emp_no
	where emp.hire_date > date_format("19890101", "%Y-%m-%d")
		and emp.gender = "F";
```

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/112bc7b94131e2919592b2b5062234e7.png)

> ì°¸ê³ : ì´í›„ì— timestamp ì»¬ëŸ¼ì„ ë§Œë“¤ê³ ë‚˜ì„œ ì†ë„ëŠ” ë” ëŠë¦¬ë‹¤
> 
> - ì¶œë ¥í•˜ëŠ” ì†ë„ ì°¨ì´?
> - ì•„ë‹ˆë©´ í…Œì´ë¸”ì´ ë¬´ê±°ì›Œì ¸ì„œ?

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/c62b129c14cebc86df3ca38d41c0e68c.png)
<br><br>
## ì¸ë±ìŠ¤ ì„¤ì •í•˜ê¸°

> where ì ˆì— ì‚¬ìš©í•˜ëŠ” ì»¬ëŸ¼ë§Œ í¬í•¨í•˜ì˜€ë‹¤.
> 
> - gender ëŠ” ì¼ë‹¨ ì¹´ë””ë‚ ë¦¬í‹°ê°€ 2 ë¼ ëºë‹¤.

```sql
create index idx_emp_before on employees(first_name, hire_date);
```

```sql
create index idx_sal_before on salaries(from_date, to_date);
```

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/16d3472e9e197c50ffd9816797088691.png)

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/d05bdf88dbf8bfbfb9d56db32fec040e.png)

### ì°¸ê³ : index ë§Œë“¤ê¸° ì „ ìƒíƒœ

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/d3e6a4c86f2779b90b6239a35ad165f6.png)

### ì¸ë±ìŠ¤ë¥¼ ì§€ì •í•˜ì—¬ ì¿¼ë¦¬í•˜ê¸°

- ì¸ë±ìŠ¤ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜´.
- ì˜¤íˆë ¤ ëŠë ¤ì¡Œë‹¤.

```sql
select emp.*, sal.salary from employees emp
use index (idx_emp_before)
	join (select * from salaries
							use index (idx_sal_before)
							where from_date > "1998-01-01" 
								and to_date < "1999-01-02") sal
	on emp.emp_no = sal.emp_no
	where emp.hire_date > date_format("19890101", "%Y-%m-%d")
		and emp.gender = "F";
```

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/5c4ac85f54c2099b88ac4a7673622dbd.png)

### ì¸ë±ìŠ¤ ì‚­ì œ

```sql
alter table employees drop index idx_emp_before;
```

```sql
alter table salaries drop index idx_sal_before;
```
<br><br>
# ì„±ëŠ¥ì„ ê°œì„ í•´ë³´ì
<br><br>
## unix timestamp ë¡œ ë³€í™˜í•˜ê¸°

> Date íƒ€ì…ì„ ë¹„ë¡¯í•œ ì‹œê°„ ê´€ë ¨ íƒ€ì…ì€ ì¸ë±ì‹± ì„±ëŠ¥ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆë‹¤ê³  í•¨.
> 
> 
> ë”°ë¼ì„œ unix timestamp ì»¬ëŸ¼ì„ í•˜ë‚˜ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸í•´ë³´ê¸°ë¡œ í•˜ì˜€ë‹¤.
> 

> ë˜í•œ
> 
> 
> int í˜•ì„ ì‚¬ìš©í•  ê²½ìš° 2038 ë…„ ë¬¸ì œê°€ ìˆìŒ.
> 
> ë”°ë¼ì„œ bigint ë¡œ ë§Œë“¤ê¸°ë¡œ í•¨.
> 
- ì‚¬ìš©ë²•

```sql
select unix_timestamp(hire_date) from employees;
```

### ì»¬ëŸ¼ ì¶”ê°€ ë° ê°’ update â€” employees

- ì»¬ëŸ¼ í•˜ë‚˜ë¥¼ ì¶”ê°€í•˜ê³ 
- ì»¬ëŸ¼ì— ê°’ì„ ì±„ì›Œì£¼ì—ˆë‹¤.

```sql
alter table employees add hire_date_timestamp bigint;
```

```sql
update employees as emp
set emp.hire_date_timestamp = unix_timestamp(emp.hire_date);
```

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/d3eead620b42f908e23a2d3397df98a2.png)

### ì»¬ëŸ¼ ì¶”ê°€ ë° ê°’ update â€” salaries

```sql
alter table salaries add from_date_timestamp bigint;
```

```sql
alter table salaries add to_date_timestamp bigint;
```

```sql
update salaries as sal
set sal.from_date_timestamp = unix_timestamp(sal.from_date), 
		sal.to_date_timestamp = unix_timestamp(sal.to_date);
```

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/c838cbff221bea92d52cb104919164ae.png)

### ê°’ ê²€ì¦

> ì•„ë˜ì™€ ê°™ì´ timestamp ë¥¼ ëº€ ê²°ê³¼ê°€ 0 ì´ ì•„ë‹Œ ë ˆì½”ë“œê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì˜€ë‹¤.
> 

```sql
select count(*)
from salaries
where from_date_timestamp - unix_timestamp(from_date) != 0;
```

```sql
select count(*)
from employees
where hire_date_timestamp - unix_timestamp(hire_date) != 0;
```

### timestamp ë¥¼ í¬í•¨í•˜ì—¬ ìƒˆë¡œìš´ ì¸ë±ìŠ¤ ë„£ê¸°

```sql
create index idx_emp on employees(first_name, hire_date_timestamp);
```

```sql
create index idx_sal on salaries(from_date_timestamp, to_date_timestamp);
```

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/d05bdf88dbf8bfbfb9d56db32fec040e.png)
<br><br>
## ì¿¼ë¦¬ë¬¸ ìˆ˜ì •í•˜ê¸°

### bigint ë¼ë„ ê°’ì´ ë„ˆë¬´ í¬ë©´ 0 ì„ ë°˜í™˜í•¨.

[MySQL unix_timestamp()ì˜ ë²”ìœ„ëŠ” ì–´ë””ê¹Œì§€ì¼ê¹Œ?](2022-06-11-MySQL%20unix_timestamp()ì˜%20ë²”ìœ„ëŠ”%20ì–´ë””ê¹Œì§€ì¼ê¹Œ.md) 

- 9999-â€¦ ì¸ ë ˆì½”ë“œê°€ ìˆë‹¤.
    - â†’ unix_timestamp(ë‚ ì§œ) ëŠ” íŠ¹ì • ë²”ìœ„ì˜ ë‚ ì§œë¥¼ ë²—ì–´ë‚˜ë©´ 0 ì„ ë°˜í™˜í•¨.
    - â†’ 0 ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤.
- ë”°ë¼ì„œ ì¿¼ë¦¬í•  ë•Œ ìƒì„¸í•˜ê²Œ ê°’ ë²”ìœ„ë¥¼ ì •í•´ì¤˜ì•¼ í•œë‹¤.
    - ì–´ë””ì„œ ì–´ë””ê¹Œì§€ì˜ ê°’ì¸ì§€.

### use index(ì¸ë±ìŠ¤ _ ì´ë¦„) ìœ¼ë¡œ ì‚¬ìš©í•  ì¸ë±ìŠ¤ë¥¼ ì •í•´ì£¼ì.

- ì•ˆ ì“°ë©´ ì˜µí‹°ë§ˆì´ì €ê°€ ìë™ìœ¼ë¡œ ì„ íƒí•œë‹¤ëŠ”ë°, pk ê¸°ë³¸ ì¸ë±ìŠ¤ë¡œ ì„ íƒí•˜ëŠ” ë“¯.

```sql
select emp.*, sal.salary
from employees emp
use index (idx_emp)
join
     (select *
      from salaries
     use index (idx_sal)
      where from_date_timestamp > unix_timestamp(str_to_date("1998-01-01", "%Y-%m-%d"))
        and from_date_timestamp < unix_timestamp(str_to_date("1999-01-02", "%Y-%m-%d"))
        and to_date_timestamp < unix_timestamp(str_to_date("1999-01-02", "%Y-%m-%d"))
        and to_date_timestamp > unix_timestamp(str_to_date("1998-01-01", "%Y-%m-%d"))
     ) sal
on emp.emp_no = sal.emp_no
where emp.hire_date_timestamp > unix_timestamp(str_to_date("1989-01-01", "%Y-%m-%d"))
  and emp.gender = "F";
```

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/f73fcb3df988e247c7bc90531a9a7443.png)

### ê²°ë¡ 

> ì‹œê°„ì€ ì ˆë°˜ ~ 1/3 ì •ë„ë¡œ ë¹¨ë¼ì¡Œë‹¤
> 

> ì¶”ê°€ì ìœ¼ë¡œ ì„±ëŠ¥ ê°œì„  ìš”ì†Œ
> 
> - ì–´ë–¤ ì»¬ëŸ¼ì„ ì¸ë±ìŠ¤ë¡œ ë§Œë“œëŠëƒì— ë”°ë¼ ë‹¤ë¥¸ ì„±ëŠ¥ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ë„?
> - ì¹´ë””ë‚ ë¦¬í‹°ê°€ 2 ì¸ gender ê°™ì€ ê²½ìš°ëŠ” ì¸ë±ìŠ¤ë¡œ ë§Œë“¤ì§€ ì•Šì•˜ëŠ”ë°, í¬í•¨í•˜ë©´ ë¹¨ë¼ì§ˆ ìˆ˜ë„?
<br><br>
## ì¶”ê°€ì ìœ¼ë¡œ ì„±ëŠ¥ ê°œì„ í•˜ê¸°

### gender ë¥¼ í¬í•¨ì‹œí‚¨ ê²½ìš°

> emp í…Œì´ë¸” ì¿¼ë¦¬ì—ì„œ gender ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì¸ë±ìŠ¤ì— í¬í•¨ì‹œì¼œë³´ì•˜ë‹¤.
> 

```sql
create index idx_emp_gender on employees(gender, first_name, hire_date_timestamp);
```

```sql
select emp.*, sal.salary
from employees emp
use index (idx_emp_gender)
join
     (select *
      from salaries
     use index (idx_sal)
      where from_date_timestamp > unix_timestamp(str_to_date("1998-01-01", "%Y-%m-%d"))
        and from_date_timestamp < unix_timestamp(str_to_date("1999-01-02", "%Y-%m-%d"))
        and to_date_timestamp < unix_timestamp(str_to_date("1999-01-02", "%Y-%m-%d"))
        and to_date_timestamp > unix_timestamp(str_to_date("1998-01-01", "%Y-%m-%d"))
     ) sal
on emp.emp_no = sal.emp_no
where emp.hire_date_timestamp > unix_timestamp(str_to_date("1989-01-01", "%Y-%m-%d"))
  and emp.gender = "F";
```

<aside>
ğŸ“Œ gender ë¥¼ ë„£ëŠ” ê²ƒì€ ê±°ì˜ ë³€í™” ì—†ìŒ.

</aside>

### pk ë¥¼ í¬í•¨ ì‹œí‚¨ ê²½ìš°

> id ë“± êµ¬ë³„ê°€ëŠ¥í•œ ê°’ì„ ë„£ì–´ë³´ì
> 
> 
> join ì— ì‚¬ìš©ë˜ëŠ” emp_no ì´ë‹¤.
> 

```sql
create index idx_emp_emp_no on employees(emp_no, first_name, hire_date_timestamp);
```

```sql
select emp.*, sal.salary
from employees emp
use index (idx_emp_emp_no)
join
     (select *
      from salaries
     use index (idx_sal)
      where from_date_timestamp > unix_timestamp(str_to_date("1998-01-01", "%Y-%m-%d"))
        and from_date_timestamp < unix_timestamp(str_to_date("1999-01-02", "%Y-%m-%d"))
        and to_date_timestamp < unix_timestamp(str_to_date("1999-01-02", "%Y-%m-%d"))
        and to_date_timestamp > unix_timestamp(str_to_date("1998-01-01", "%Y-%m-%d"))
     ) sal
on emp.emp_no = sal.emp_no
where emp.hire_date_timestamp > unix_timestamp(str_to_date("1989-01-01", "%Y-%m-%d"))
  and emp.gender = "F";
```

![image](https://s3.ap-northeast-2.amazonaws.com/donkeyadonkey-assets/img/cf525fe7e9ca10345001372cd5395468.png)

<aside>
ğŸ“Œ pk ë¥¼ ë„£ìœ¼ë‹ˆ í™• ë¹¨ë¼ì¡Œë‹¤.

</aside>

- 0.07 ì´ˆê¹Œì§€ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸.

### ì •ë ¬í•˜ê¸°

- ì†ë„ì— ê±°ì˜ ì˜í–¥ ì—†ìŒ.
- ë” í° ë°ì´í„°ì…‹ì—ì„œ ì‹¤í—˜í•´ë³¼ í•„ìš”ê°€ ìˆë‹¤.

```sql
select emp.*, sal.salary
from employees emp
use index (idx_emp_emp_no)
join
     (select *
      from salaries
     use index (idx_sal)
      where from_date_timestamp > unix_timestamp(str_to_date("1998-01-01", "%Y-%m-%d"))
        and from_date_timestamp < unix_timestamp(str_to_date("1999-01-02", "%Y-%m-%d"))
        and to_date_timestamp < unix_timestamp(str_to_date("1999-01-02", "%Y-%m-%d"))
        and to_date_timestamp > unix_timestamp(str_to_date("1998-01-01", "%Y-%m-%d"))
     ) sal
on emp.emp_no = sal.emp_no
where emp.hire_date_timestamp > unix_timestamp(str_to_date("1989-01-01", "%Y-%m-%d"))
  and emp.gender = "F"
order by emp.emp_no;
```

### ê¸°íƒ€ ì„±ëŠ¥ ê°œì„ ê³¼ ê´€ë ¨ëœ ì´ìŠˆ

- ì—°êµ¬í•´ë³¼ í•„ìš”ê°€ ìˆë‹¤.

[MySQL ì†ë„ ê°œì„  TIP](https://kimyhcj.tistory.com/410)
<br><br>
# ì°¸ì¡°

[[MySQL] ì¸ë±ìŠ¤(INDEX) ì •ë¦¬(íš¨ê³¼ì ì¸ INDEX ì„¤ê³„)](https://spiderwebcoding.tistory.com/6)

[ì½”ë”©êµìœ¡ í‹°ì”¨í”¼ìŠ¤ì¿¨](http://www.tcpschool.com/mysql/mysql_index_create)

[[MySQL] í…Œì´ë¸” ìƒì„±, ì»¬ëŸ¼ ì¶”ê°€, ì‚­ì œ, ìˆ˜ì •](https://mcpaint.tistory.com/194)

[[mysql] ì¸ë±ìŠ¤ ì •ë¦¬ ë° íŒ](https://jojoldu.tistory.com/243)